<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="">
    <meta name="author" content="">
	
    <title>Mobile Shop</title>
	
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css"  type="text/css">
	
	<!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
	
	
	<!-- Custom Fonts -->
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css"  type="text/css">
    <link rel="stylesheet" href="fonts/font-slider.css" type="text/css">
	
	<!-- jQuery and Modernizr-->
	<script src="../js/jquery.min.js"></script>
	
	<!-- Core JavaScript Files -->  	 
    <script src="../js/bootstrap.min.js"></script>
	
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="js/html5shiv.js"></script>
        <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
	<!--Top-->
	<nav id="top">
		<div class="container">
			<div class="row">
				<div class="col-xs-6">
				</div>
				<div class="col-xs-6">
					<ul class="top-link">
						<li><a href="/goToAccount"><span class="glyphicon glyphicon-user"></span> 我的账户</a></li>
						<li><a href="/goToContact"><span class="glyphicon glyphicon-envelope"></span> 联系我们</a></li>
					</ul>
				</div>
			</div>
		</div>
	</nav>
	<!--Header-->
	<header class="container">
		<div class="row">
			<div class="col-md-4">
				<div id="logo"><img src="images/logo.png" /></div>
			</div>
			<div class="col-md-4">
				<form class="form-search">  
					<input type="text" class="input-medium search-query">  
					<button type="submit" class="btn"><span class="glyphicon glyphicon-search"></span></button>  
				</form>
			</div>
			<div class="col-md-4">
				<div id="cart"><a class="btn btn-1" href="/goToCart"><span class="glyphicon glyphicon-shopping-cart"></span>CART </a></div>
			</div>
		</div>
	</header>

	<!--菜单栏-->
	<!--Navigation-->
	<nav id="menu" class="navbar">
		<div class="container">
			<div class="navbar-header"><span id="heading" class="visible-xs">Categories</span>
				<button type="button" class="btn btn-navbar navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"><i
					 class="fa fa-bars"></i></button>
			</div>
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav">
					<li><a href="/goToIndex">Home</a></li>
					<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">电脑专区</a>
						<div class="dropdown-menu">
							<div class="dropdown-inner">
								<ul class="list-unstyled">
									<li><a href="/goToCategory">Windows</a></li>
									<li><a href="/goToCategory">MacBook</a></li>
								</ul>
							</div>
						</div>
					</li>
					<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">手机</a>
						<div class="dropdown-menu">
							<div class="dropdown-inner">
								<ul class="list-unstyled">
									<li><a href="#" onclick ="">Apple</a></li>
									<li><a href="/goToCategory">HuaWei</a></li>
									<li><a href="/goToCategory">Samsung</a></li>
									<li><a href="/goToCategory">Lenovo</a></li>
									<li><a href="/goToCategory">OPPO</a></li>
								</ul>
							</div>
						</div>
					</li>
					<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">影音娱乐</a>
						<div class="dropdown-menu" style="margin-left: -203.625px;">
							<div class="dropdown-inner">
								<ul class="list-unstyled">
									<li><a href="/goToCategory">Apple</a></li>
									<li><a href="/goToCategory">华为</a></li>
									<li><a href="/goToCategory">微软</a></li>
									<li><a href="/goToCategory">联想</a></li>
									<li><a href="/goToCategory">三星</a></li>
								</ul>
								<ul class="list-unstyled">
									<li><a href="/goToCategory">台电</a></li>
									<li><a href="/goToCategory">酷比魔方</a></li>
									<li><a href="/goToCategory">小米</a></li>
									<li><a href="/goToCategory">华硕</a></li>
									<li><a href="/goToCategory">宏碁</a></li>
								</ul>
								<ul class="list-unstyled">
									<li><a href="/goToCategory">索尼</a></li>
									<li><a href="/goToCategory">爱国者</a></li>
									<li><a href="/goToCategory">纽曼</a></li>
									<li><a href="/goToCategory">飞利浦</a></li>
									<li><a href="/goToCategory">锐族</a></li>
								</ul>
							</div>
						</div>
					</li>
					<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">家用电器</a>
						<div class="dropdown-menu" style="margin-left: -203.625px;">
							<div class="dropdown-inner">
								<ul class="list-unstyled">
									<li><a href="/goToCategory">海尔</a></li>
									<li><a href="/goToCategory">奥克斯</a></li>
									<li><a href="/goToCategory">海信</a></li>
									<li><a href="/goToCategory">格力</a></li>
									<li><a href="/goToCategory">美的</a></li>
								</ul>
								<ul class="list-unstyled">
									<li><a href="/goToCategory">TCL</a></li>
									<li><a href="/goToCategory">长虹</a></li>
									<li><a href="/goToCategory">小天鹅</a></li>
									<li><a href="/goToCategory">西门子</a></li>
									<li><a href="/goToCategory">松下</a></li>
								</ul>
							</div>
						</div>
					</li>
					<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">摄影专区</a>
						<div class="dropdown-menu" style="margin-left: -203.625px;">
							<div class="dropdown-inner">
								<ul class="list-unstyled">
									<li><a href="/goToCategory">佳能</a></li>
									<li><a href="/goToCategory">尼康</a></li>
									<li><a href="/goToCategory">索尼</a></li>
									<li><a href="/goToCategory">徕卡</a></li>
									<li><a href="/goToCategory">松下</a></li>
								</ul>
								<ul class="list-unstyled">
									<li><a href="/goToCategory">富士</a></li>
									<li><a href="/goToCategory">宾得</a></li>
									<li><a href="/goToCategory">卡西欧</a></li>
									<li><a href="/goToCategory">小米</a></li>
									<li><a href="/goToCategory">奥林巴斯</a></li>
								</ul>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!--//////////////////////////////////////////////////-->
	<!--///////////////////Cart Page//////////////////////-->
	<!--//////////////////////////////////////////////////-->
	<div id="page-content" class="single-page">
		<div class="container">
			<!-- 位置条形栏 -->
			<div class="row">
				<div class="col-lg-12">
					<ul class="breadcrumb">
						<li><a href="/goToIndex">Home</a></li>
						<li><a href="/goToCart">购物车</a></li>
					</ul>
				</div>
			</div>
			<!-- 商品展示 -->
			<div class="row" id="proList">
			</div>
			
			<div class="row">
				<div class="col-md-4 col-md-offset-8 ">
					<center><a href="/goToIndex" class="btn btn-1">继续购物</a></center>
				</div>
			</div>
			<div class="row">
				<div class="pricedetails">
					<div class="col-md-4 col-md-offset-8">
						<table>
								<tr>
								<td><h6>合计：</h6></td>
								<td id ="totalPriceValue"></td>
							</tr>
						</table>
						<center><a href="#" class="btn btn-1" id = "checkStyle" onclick = "payOrder('/alipay/pay');">结算</a></center>
					</div>
				</div>
			</div>
		</div>
	</div>	
	<footer>
		<div class="container">
			<div class="wrap-footer">
				<div class="row">
					<div class="col-md-3 col-footer footer-1">
						<img src="images/logofooter.png" />
						<p>本网站仅用于2018级天软毕业设计使用.</p>
					</div>
					<div class="col-md-3 col-footer footer-2">
						<div class="heading"><h4>顾客服务</h4></div>
						<ul>
							<li><a href="#">关于我们</a></li>
							<li><a href="#">开发者信息</a></li>
							<li><a href="#">隐私</a></li>
							<li><a href="#">常见问题</a></li>
							<li><a href="#">联系我们</a></li>
						</ul>
					</div>
					<div class="col-md-3 col-footer footer-3">
						<div class="heading"><h4>账户信息</h4></div>
						<ul>
							<li><a href="/goToAccount">我的账户</a></li>
							<li><a href="#">订单查询</a></li>
							<li><a href="#">我的收藏</a></li>
							<li><a href="#">浏览记录</a></li>
							<li><a href="#">我的优惠卷</a></li>
						</ul>
					</div>
					<div class="col-md-3 col-footer footer-4">
						<div class="heading"><h4>联系我们</h4></div>
						<ul>
							<li><span class="glyphicon glyphicon-home"></span>地址：天津市西青区宾水西道399号</li>
							<li><span class="glyphicon glyphicon-earphone"></span>+91 8866888111</li>
							<li><span class="glyphicon glyphicon-envelope"></span>邮编：300387</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="copyright">
			<div class="container">
				<div class="row">
					<div class="col-md-6" id="foot-center">
						Copyright &copy; 2018. &nbsp;&nbsp;Pray版权所有.
					</div>
					<div class="col-md-6">
						<div class="pull-right">
							<ul>
								<li><img src="images/visa-curved-32px.png" /></li>
								<li><img src="images/paypal-curved-32px.png" /></li>
								<li><img src="images/discover-curved-32px.png" /></li>
								<li><img src="images/maestro-curved-32px.png" /></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</footer>

	<script>
	$(document).ready(function () {
		getMemberCart();
		});
	
	function getMemberCart(){
			var mycontent = $("#proList");
			var htmls = "";
			mycontent.innerHTML = "";
			$.ajax({
				type: "GET",
				url: "/cart/list",
				success: function (data) {
					var jsonArray = data.data;
					for (var temp in jsonArray) {
						htmls += '<form id = "formCart" action = "/alipay/pay" method = "post"><div class="row"><div class="product well"><div class="col-md-3"><div class="image"><img src="' + jsonArray[temp].productPic +'" /></div></div><div class="col-md-9"><div class="caption">'+
					'<div class="name"><h3><a href="#" onclick="gotoProductPage(\''+jsonArray[temp].productId+'\')">' + jsonArray[temp].productName +'</a></h3><span>'+jsonArray[temp].productSubTitle+'</span></div>'+
					'<div class="info"><ul><li>SkuID: '+jsonArray[temp].productSkuId+'</li></ul></div><div class="price">￥'+jsonArray[temp].price+'</div>'+
					'<label>数量: </label> <input class="form-inline quantity" type="number" value="'+Number(jsonArray[temp].quantity)+'" id ="proNumber"><a href="#" class="btn btn-2 " onclick="updateProNumber(\''+jsonArray[temp].id+'\')">Update</a>'+
					'<hr><a href="#" class="btn btn-default pull-right" onclick="removeProduct('+jsonArray[temp].id+');">移除</a></div></div><div class="clear"></div></div></div></form>'
				}
				mycontent.html(htmls);
				matchPrice();
				}
			});
		}
		function matchPrice(){
			var content = $("#totalPriceValue");
			content.innerHTML = "￥";
			$.ajax({
				type: "post",
				url: "/cart/price",
				async: false,
				success: function (data) {
					var temp = toDecimal2(data);
					content.html(temp);
				}
			});
		}	
		//制保留2位小数，如：2，会在2后面补上00.即2.00 
		function toDecimal2(x) { 
		var f = parseFloat(x); 
		if (isNaN(f)) { 
		return false; 
		} 
		var f = Math.round(x*100)/100; 
		var s = f.toString(); 
		var rs = s.indexOf('.'); 
		if (rs < 0) { 
		rs = s.length; 
		s += '.'; 
		} 
		while (s.length <= rs + 2) { 
		s += '0'; 
		} 
		return s; 
		} 
		function removeProduct(id) {
			$.ajax({
				type: "post",
				url: "/cart/delete",
				data:{
					ids:id
				},
				async: false,
				success: function (data) {
					if (data.code ==200) {
						alert("已从购物车删除");
						getMemberCart();
					}else{
						alert("API错误")
					}
				}
			});
		}
		function payOrder(action){
			document.getElementById("formCart").action = action
			document.getElementById("formCart").submit()
		}

		function gotoProductPage(productId){
			
			sessionStorage.setItem("proId",productId);
			window.location.href="/getProduct";
			
		}
		function updateProNumber(id){
			$.ajax({
				type: "post",
				url: "/cart/update/quantity",
				data:{
					id:id,
					quantity:$("#proNumber").val()
				},
				async: false,
				success: function (data) {
					if (data.code ==200) {
						alert("更新成功");
						getMemberCart();
					}else{
						alert("API错误")
					}
				}
			});
		}
	</script>
</body>
</html>
